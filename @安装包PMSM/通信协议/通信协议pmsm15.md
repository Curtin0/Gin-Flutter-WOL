## 1  PMSM15数据解析(推测版本)

类似freemodbus，查询和下发指令分开。

备注: 波特率38400

#### 1.1 上位机->串口设备

查询指令  总3字节

| 指令1 原始数据 | 2a   | c0      | 40                |
| -------------- | ---- | ------- | ----------------- |
| HEX            | 0x2a |         | 0x40              |
| 中文解析       | 帧头 | 功能码? | 校验码(checksum1) |

------

操作指令  总9字节 

| 指令2 原始数据 | 2e   | 01      | 00   | 04   | 01                  | 00   | 21 00     | 55                |
| -------------- | ---- | ------- | ---- | ---- | ------------------- | ---- | --------- | ----------------- |
| HEX            | 0x2e | 0x01    |      |      | 0x01                |      | 0x0021    | 0x55              |
| 中文解析       | 帧头 | 功能码? | ?    | ?    | 恒转速01/模拟转速00 | ?    | 转速33rpm | 校验码(checksum2) |

备注:查询指令和操作指令轮询下发

#### 1.2 设备->上位机  

查询指令回复  共55个字节

| 原始数据 | 2a   | 00                | 16 01        | 00 00 | a6 02      | 00 00 | 1f 00   | 00 00 | 3e 00   | 00 00 | 35 00   | 00 00 | 41 00   | 00 00 00 00 | 00 00 06 00 | 00 00 8e 0a    | 00 00 00 00 | 00 00 00 00 | 00 00 00 00 | 00 00 00 00 | 00 00 | da     |
| -------- | ---- | ----------------- | ------------ | ----- | ---------- | ----- | ------- | ----- | ------- | ----- | ------- | ----- | ------- | ----------- | ----------- | -------------- | ----------- | ----------- | ----------- | ----------- | ----- | ------ |
| HEX      | 0x2a | 0x00              | 0x0116       |       | 0x02a6     |       | 0x001f  |       | 0x003e  |       | 0x0035  |       | 0x0041  |             | 0x0006      | 0x0a8e         |             |             |             |             |       | 0xda   |
| DEC      | 41   | 0                 | 278          |       | 678        |       | 31      |       | 62      |       | 53      |       | 65      | ?           | ?           | 2702           |             |             |             |             |       | 218    |
| 中文解析 | 帧头 | 当前状态:正常运行 | 母线电压278V |       | 转速678rpm |       | 31°C    |       | U电流   |       | V电流   |       | W电流   | ?           | ?           | 调速电压2702mV | X加速度     | Y加速度     | Z加速度     | 加速度和    | ?     | 校验码 |
| 位置     | [0]  | [1]               | [2-3]        |       | [6-7]      |       | [10-11] |       | [14-15] |       | [18-19] |       | [22-23] |             |             | [34-35]        | [38-39]     | [42-43]     | [46-47]     | [50-51]     |       | [54]   |

------

操作指令回复 25字节 例：

```
2E 01 00 14 01 00 00 00 00 00 00 00 54 00 1A 00 48 00 00 00 3E 05 00 00 3D
```

---

#### 1.3 校验码

指令1校验码计算

```python
a1 =[0x2a,0xc0]
check_sum1 =0
check_sum1 =a1[1]
b1=-check_sum1
print(b1&0x00ff)
```

指令2校验码计算

```python
a2 =[0x2E,0x01,0x00,0x04,0x01,0x00,0x21,0x00]
check_sum2 =0
check_sum2 =a2[0]+a2[1]+a2[2]+a2[3]+a2[4]+a2[5]+a2[6]+a2[7]
print(check_sum2&0xFF)
```

